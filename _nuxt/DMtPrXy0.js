import{_ as ot}from"./EhEUCJbV.js";import{_ as O}from"./Dq3GPOqN.js";import{U as Q,Z as X,ab as tt,a0 as V,a7 as et,i as f,j,W as t,o as _,c as g,a,t as n,f as k,x as p,K as B,Y as J,b as v,V as it,a6 as rt,$ as ct,a1 as ut,k as _t,l as dt,u as N,aj as pt,a4 as mt,a5 as bt}from"./DSD2pUNw.js";import{u as ft}from"./BLR1aNLP.js";import{p as vt}from"./D2M15My9.js";import{g as G}from"./DiADfKRX.js";import{_ as yt}from"./BF6_8xTD.js";import{_ as ht}from"./CKIiqM3i.js";import{u as wt}from"./oMPCwqzb.js";import{u as gt}from"./CygSoWUo.js";import"./CqLY2vNr.js";import"./mYk17c8H.js";import"./CrE1ES4d.js";import"./D8aEg3BZ.js";import"./56Y_7FHu.js";import"./R1YRABMb.js";const kt={key:0,class:"tw-bg-bg-secondary tw-p-4 tw-rounded tw-mb-4"},Bt={key:0,class:"tw-flex tw-justify-center tw-font-bold"},xt={class:"tw-mx-0.5"},zt={key:1,class:"tw-flex tw-justify-center tw-font-bold"},Ct={class:"tw-me-1"},It={class:"tw-flex tw-justify-center tw-mt-2"},Mt={class:"tw-mx-1"},$t=["src"],Lt=Q({__name:"BattleWinMessage",props:{battleBoard:{},battleData:{},status:{},battleId:{}},emits:["update-board"],setup(K,{emit:l}){const D=l,y=K,{t:u}=X(),x=tt(),{getMainUser:z}=V(x),C=et(),{claimBattlePrize:I}=C,{platformCommasFormat:M}=ft(),h=f(!1),s=j(()=>{const o={ids:[],names:[],prize:0,can_claim_prize:!1};return y.battleBoard.forEach(r=>{+r.prize>0&&(o.ids.push(r.main_user_id),o.names.push(r.username)),r.main_user_id===z.value&&(o.prize=+r.prize,o.can_claim_prize=r.can_claim_prize)}),o}),W=j(()=>{var o;return(o=y.battleData)!=null&&o.points_entry_fee?"nuxPoint":y.battleData.battle_currency}),R=async()=>{try{await I({battleId:y.battleData.battle_id}),h.value=!0,D("update-board")}catch(o){console.error("claimPrize BattleWinMessage",o)}};return(o,r)=>{const w=O;return o.status===3&&t(s).ids.length?(_(),g("div",kt,[!t(h)&&t(s).ids.includes(t(z))?(_(),g("div",Bt,[a("span",null,n(t(u)("congratulations"))+"!",1),a("span",xt,n(t(u)("you")),1),a("span",null,n(t(u)("have_won_the_battle")),1)])):(_(),g("div",zt,[a("span",Ct,n(t(s).names.join(", ")),1),a("span",null,n(t(s).names.length>1?t(u)("have_won_the_battle"):t(u)("has_won_the_battle")),1)])),a("div",It,[!t(s).prize||t(h)?(_(),k(w,{key:0,link:t(J).pvp_battle,"is-link":""},{default:p(()=>[B(n(t(u)("return_to_battles")),1)]),_:1},8,["link"])):v("",!0),t(s).prize&&t(s).can_claim_prize&&!t(h)?(_(),k(w,{key:1,onClick:R},{default:p(()=>[B(n(t(u)("claim"))+" ",1),a("span",Mt,n(t(M)(t(vt),t(s).prize)),1),a("img",{src:t(G)(t(W))},null,8,$t)]),_:1})):v("",!0),t(s).prize&&!t(s).can_claim_prize?(_(),k(w,{key:2,link:t(J).pvp_battle,"is-link":""},{default:p(()=>[B(n(t(u)("back_to_battles")),1)]),_:1},8,["link"])):v("",!0)])])):v("",!0)}}}),St={class:"tw-grow"},Tt={class:"players"},Pt={class:"tw-text-text-tertiary"},Ut={class:"invite"},Nt={class:"tw-text-text-tertiary"},Vt={class:"tw-text-text-brand"},jt={class:"tw-flex tw-itwms-center tw-gap-1"},Dt=["src"],Wt={class:"tw-flex tw-itwms-center tw-gap-1"},Rt=["src"],Et=Q({__name:"lobby-[id]",setup(K){const{t:l}=X(),D=it(),y=rt(),{setBreadcrumbs:u}=wt();u([{label:l("battles"),path:D({name:"battles"})},{label:l("pvp_lobby")}]);const x=et(),z=ct(),C=tt(),I=ut(),{isLessContainerTablet:M,isMultiBalance:h}=V(z),{getUserBattle:s,getCurrency:W}=V(C),{isLoggedIn:R}=V(I),{switchUser:o}=I;let r,w;const $=f(!1),m=f(null),i=f(null),E=f([]),A=f(!0),at=f([{title:"#",align:"left",key:"position",width:"24px"},{title:l("players"),align:"left",key:"username"},{title:l("status"),align:"left",key:"status",hideTablet:!0,hideMobile:!0},{title:l("spins_lobby"),align:"left",key:"spins_left",hideTablet:!0,hideMobile:!0},{title:l("winnings"),align:"left",key:"winnings"},{title:l("consecutive_wins"),align:"left",key:"max_consecutive_wins",hideTablet:!0,hideMobile:!0},{title:l("max_multiplier"),align:"left",key:"max_multiplier",hideTablet:!0,hideMobile:!0},{title:l("prize"),align:"left",key:"prize"}]),st=j(()=>E.value.map((e,d)=>({position:d+1,...e,status:l("leader_"+e.status.replace(" ","_").toLowerCase())}))),nt=j(()=>M.value?"24px repeat(3, 1fr)":"24px repeat(7, 1fr)"),lt=()=>{pt(location.href),$.value=!0,setTimeout(()=>{$.value=!1},4e3)},H=async()=>{const{data:e,status:d}=await x.fetchBattleByLink({link:y.params.id});if(d){if(clearInterval(r),i.value=e,m.value=e.battle_id,s.value){const b={...s.value};b.timer=e.timer,C.setUserBattle(b)}(e.battle_status===2||e.battle_status===1)&&(r=window.setInterval(()=>{H()},1e4))}else i.value=null,m.value=null},F=async e=>{const{data:d}=await x.fetchBattleLeaderBoard({battleId:e});E.value=d};return _t(async()=>{var e,d,b,L,S,T,P,U;await H(),m.value&&(await F(m.value),(((e=i.value)==null?void 0:e.battle_status)===1||((d=i.value)==null?void 0:d.battle_status)===2)&&(w=window.setInterval(()=>{m.value&&F(m.value)},1e4))),R.value&&h.value&&((b=s.value)==null?void 0:b.player_origin_currency)!==W.value&&((L=s.value)==null?void 0:L.battle_link)===((S=i.value)==null?void 0:S.link)&&(((T=i.value)==null?void 0:T.battle_status)===1||((P=i.value)==null?void 0:P.battle_status)===2)&&o((U=s.value)==null?void 0:U.player_origin_currency),A.value=!1}),dt(()=>{clearInterval(r),clearInterval(w)}),gt({title:()=>{var e;return((e=i.value)==null?void 0:e.game_name)??"PVP Match"}}),(e,d)=>{const b=ot,L=Lt,S=mt,T=O,P=yt,U=ht;return _(),k(U,{loading:t(A),class:"lobby"},{default:p(()=>{var Y,Z,q;return[a("div",null,[t(i)?(_(),k(b,{key:0,item:t(i),"is-column":!t(M)},null,8,["item","is-column"])):v("",!0)]),a("div",St,[N(L,{"battle-board":t(E),"battle-data":t(i),status:((Y=t(i))==null?void 0:Y.battle_status)||0,"battle-id":t(m),onUpdateBoard:F},null,8,["battle-board","battle-data","status","battle-id"]),a("div",Tt,[a("span",Pt,n((Z=t(i))==null?void 0:Z.active_participant_count)+" "+n(t(l)("players")),1),a("div",Ut,[a("span",Nt,n(t(l)((q=t(i))!=null&&q.is_private?"private_match":"public_match")),1),N(T,{"label-key":t($)?"link_copied":"invite_players","is-with-icon":"","color-type":"secondary","is-disabled":t($),onClick:lt},{default:p(()=>[N(S,{name:"copy",size:20})]),_:1},8,["label-key","is-disabled"])])]),N(P,{header:t(at),list:t(st),class:"leader-board",type:"grid","has-dash":"","grid-templates":t(nt)},{"header-winnings":p(({header:c})=>[a("span",Vt,n(c.title),1)]),winnings:p(({item:c})=>[a("div",jt,[B(n(c.winnings||"-")+" ",1),c.currency&&c.winnings?(_(),g("img",{key:0,src:t(G)(c.currency)},null,8,Dt)):v("",!0)])]),prize:p(({item:c})=>[a("div",Wt,[B(n(c.prize||"-")+" ",1),c.currency&&c.prize?(_(),g("img",{key:0,src:t(G)(c.currency)},null,8,Rt)):v("",!0)])]),_:1},8,["header","list","grid-templates"])])]}),_:1},8,["loading"])}}}),ne=bt(Et,[["__scopeId","data-v-5cfd7d88"]]);export{ne as default};
